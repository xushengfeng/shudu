import { expect, test } from "vitest";
import { mySolver2 } from "../src/shudu.ts";

const l: { q: string; a: string[] }[] = [
	{
		q: "071068239002490060905030800104856920000000100750020006208600371000017008500000002",
		a: [
			"471568239382491765965732814134856927826974153759123486298645371643217598517389642",
		],
	},
	{
		q: "000005000000700001000010425610570080400100000000803000007000139509030000000200600",
		a: [
			"126345897954782361873916425612574983438129576795863214267458139589631742341297658",
		],
	},
	{
		q: "000203070002089001600017800093002058000070004405008000017004300050700090906020000",
		a: [
			"581263479372489561649517823793142658128675934465398217217954386854736192936821745",
		],
	},
	{
		q: "150000003004000502060070009500706300702004100006010000000320000320008700005000031",
		a: [
			"158249673974863512263175849519786324782934165436512987697321458321458796845697231",
		],
	},
	{
		q: "001500200200001070407060001004700900009600080000894015070000040920000006105000800",
		a: [
			"391547268256381479487962531864715923519623784732894615678159342923478156145236897",
		],
	},
	{
		q: "500000300020100070008000009040007000000821000000600010300000800060004020009000005",
		a: [
			"591476382423189576678253149146397258735821694982645713354912867867534921219768435",
		],
	},
	{
		q: "800050000003600000070090200050007000300045700000100030001000068008500010090000400",
		a: [
			"812753649943682175675491283154237896369845721287169534521974368438526917796318452",
		],
	},
];

test("solve", () => {
	for (const x of l) {
		const l = x.q
			.split("")
			.map((i) => ("1" <= i && i <= "9" ? Number(i) : null));
		const xx = mySolver2(l);
		console.log("thinking", x.q);
		console.log(xx.fullLog.length, xx.branchCount);
		expect(xx.board.length).eq(x.a.length);

		for (const i of xx.board) {
			if (!x.a.includes(i.join(""))) {
				console.log("fail");
				throw new Error("fail");
			} else {
				console.log("pass", i.join(""));
			}
		}
	}
});

test("宫格消除 Claiming", () => {
	const l: { q: string; a: string[] }[] = [
		{
			q: "000500000020900740068300100000000813000060000175000000007002430054003060000007000",
			a: [
				"749521386321986745568374129692745813483169572175238694917652438254813967836497251",
			],
		},
	];
	for (const x of l) {
		const l = x.q
			.split("")
			.map((i) => ("1" <= i && i <= "9" ? Number(i) : null));
		const xx = mySolver2(l);

		console.log(xx.fullLog.length, xx.branchCount);

		const i = xx.board[0];
		expect(i.join("")).toBe(x.a[0]);
	}
});
test("隐藏对", () => {
	const l: { q: string; a: string[] }[] = [
		{
			q: "293417685000002010701058020000000109019000802004001000107080206002106008008720301",
			a: [
				"293417685485962713761358924876245139519673842324891567137584296952136478648729351",
			],
		},
		{
			q: "298573006163894725475200938740000081830000000651708093314900050520000009980105004",
			a: [
				"298573146163894725475216938742359681839641572651728493314962857526487319987135264",
			],
		},
		{
			q: "080000060009007000000806023802375040003100000010000530400712080000080270008400300",
			a: [
				"287531469369247158145896723892375641573164892614928537436712985951683274728459316",
			],
		},
	];
	for (const x of l) {
		const l = x.q
			.split("")
			.map((i) => ("1" <= i && i <= "9" ? Number(i) : null));
		const xx = mySolver2(l, [
			"singleCandidate",
			"uniqueCandidate",
			"hiddenPair",
			"hiddenTriple",
		]);

		console.log(
			xx.fullLog.length,
			xx.branchCount,
			new Set(
				xx.fullLog.map((i) =>
					"strategyName" in i ? i.strategyName : "unknown",
				),
			).values(),
		);
		const i = xx.board[0];
		expect(i.join("")).toBe(x.a[0]);
	}
});

test("xwing", () => {
	const l: { q: string; a: string[] }[] = [
		{
			q: "600009000013027960794860200006083759907050000005970000000000000371690800060040100",
			a: [
				"682319574513427968794865213146283759927154386835976421458731692371692845269548137",
			],
		},
	];
	for (const x of l) {
		const l = x.q
			.split("")
			.map((i) => ("1" <= i && i <= "9" ? Number(i) : null));
		const xx = mySolver2(l);

		console.log(
			xx.fullLog.length,
			xx.branchCount,
			new Set(
				xx.fullLog.map((i) =>
					"strategyName" in i ? i.strategyName : "unknown",
				),
			).values(),
		);
		const i = xx.board[0];
		expect(i.join("")).toBe(x.a[0]);
	}
});

test("xywing", () => {
	const l: { q: string; a: string[] }[] = [
		{
			q: "094087000008000090321050487900148256482070139165090874816720045000060708000800060",
			a: [
				"694387521758412693321956487973148256482675139165293874816729345239564718547831962",
			],
		},
	];
	for (const x of l) {
		const l = x.q
			.split("")
			.map((i) => ("1" <= i && i <= "9" ? Number(i) : null));
		const xx = mySolver2(l);

		console.log(
			xx.fullLog.length,
			xx.branchCount,
			new Set(
				xx.fullLog.map((i) =>
					"strategyName" in i ? i.strategyName : "unknown",
				),
			).values(),
		);
		const i = xx.board[0];
		expect(i.join("")).toBe(x.a[0]);
	}
});
