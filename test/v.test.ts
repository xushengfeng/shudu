import { expect, test } from "vitest";
import { creatBoardItemFromValue } from "../src/shudu";
import { v } from "../src/v";

test("最简单的数独：仅缺 1 格", async () => {
	// 一个完整的数独终盘（取自常见范例）
	const solved = [
		5, 3, 4, 6, 7, 8, 9, 1, 2, 6, 7, 2, 1, 9, 5, 3, 4, 8, 1, 9, 8, 3, 4, 2, 5,
		6, 7, 8, 5, 9, 7, 6, 1, 4, 2, 3, 4, 2, 6, 8, 5, 3, 7, 9, 1, 7, 1, 3, 9, 2,
		4, 8, 5, 6, 9, 6, 1, 5, 3, 7, 2, 8, 4, 2, 8, 7, 4, 1, 9, 6, 3, 5, 3, 4, 5,
		2, 8, 6, 1, 7, 9,
	];

	// 挖掉第一格（索引 0）
	const boardWithOneEmpty = solved.map((val, idx) => (idx === 0 ? null : val));

	// 转换为 BoardItem[]
	const board = creatBoardItemFromValue(boardWithOneEmpty);

	// 运行回溯求解器
	const r = await v(board);
	console.log(r);

	// 预期：控制台会输出找到 1 个解，并且填回的数字是 5
});

test("各种情况", async () => {
	const l: { q: string; a: string[] }[] = [
		{
			q: "071068239002490060905030800104856920000000100750020006208600371000017008500000002",
			a: [
				"471568239382491765965732814134856927826974153759123486298645371643217598517389642",
			],
		},
		{
			q: "000005000000700001000010425610570080400100000000803000007000139509030000000200600",
			a: [
				"126345897954782361873916425612574983438129576795863214267458139589631742341297658",
			],
		},
		{
			q: "000203070002089001600017800093002058000070004405008000017004300050700090906020000",
			a: [
				"581263479372489561649517823793142658128675934465398217217954386854736192936821745",
			],
		},
		{
			q: "150000003004000502060070009500706300702004100006010000000320000320008700005000031",
			a: [
				"158249673974863512263175849519786324782934165436512987697321458321458796845697231",
			],
		},
		{
			q: "001500200200001070407060001004700900009600080000894015070000040920000006105000800",
			a: [
				"391547268256381479487962531864715923519623784732894615678159342923478156145236897",
			],
		},
		{
			q: "500000300020100070008000009040007000000821000000600010300000800060004020009000005",
			a: [
				"591476382423189576678253149146397258735821694982645713354912867867534921219768435",
			],
		},
		{
			q: "800050000003600000070090200050007000300045700000100030001000068008500010090000400",
			a: [
				"812753649943682175675491283154237896369845721287169534521974368438526917796318452",
			],
		},
	];
	for (const x of l) {
		const q = x.q
			.split("")
			.map((i) => ("1" <= i && i <= "9" ? Number(i) : null));
		const board = creatBoardItemFromValue(q);
		console.log("xxxx");

		const xx = await v(board);
		expect(xx.solutionIds.length).eq(x.a.length);

		for (const id of xx.solutionIds) {
			const node = xx.nodes.get(id);
			if (!node) {
				throw new Error(`solution ${id} no exsit`);
			}
			const filledBoard = node.board;
			if (!x.a.includes(filledBoard.join(""))) {
				console.log("fail");
				throw new Error("fail");
			}
		}
	}
});
